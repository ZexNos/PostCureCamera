    # Post‑Cure Camera — Presets, Safety & UVLOCK

    Этот файл объединяет структуру пресетов CURE/DRY и логику UVLOCK и RGB‑индикатора.

    ---

    ## 1. Presets — Профили CURE/DRY

    (source: docs/README_Files/Presets.md)

    # Presets — Профили CURE/DRY (v1.0)
**Updated:** 2025-11-09 11:04

Цель: формализовать структуру пресета и стартовый набор профилей.  
**Правило UV‑LOCK:** в режимах DRY (сушка филамента) **UV запрещён** и игнорируется прошивкой.

---

## Структура пресета
- `mode`: `CURE` | `DRY`
- `name`: отображаемое имя
- `target_temp`: °C (для DRY 45–90°C; для CURE опционально 30–50°C)
- `uv_power`: % (для DRY всегда 0 из‑за UV‑LOCK; для CURE 0–100%)
- `duration`: минуты (CURE обычно 10–30 мин; DRY 240–480 мин)
- `fan_inner`: % (внутренний обдув, типично 30–40%)
- `fan_exhaust`: % (выхлоп, типично 10–20%)
- `notes`: пояснения/ограничения

Хранение: **жёстко в коде** (на текущем этапе). Позже можно вынести в NVS/JSON.

---

## DRY пресеты (актуальная UV-LOCK политика)
```json
    {
      "mode": "DRY",
      "name": "DRY_PLA",
      "target_temp": 55,
      "uv_power": 0,
      "duration": 360,  
      "fan_inner": 100,
      "fan_exhaust": 8,
      "notes": "PLA"
    },
    {
      "mode": "DRY",
      "name": "DRY_PETG",
      "target_temp": 65,
      "uv_power": 0,
      "duration": 420,   
      "fan_inner": 100,
      "fan_exhaust": 10,
      "notes": "PETG"
    },
    {
      "mode": "DRY",
      "name": "DRY_PETG_CF",
      "target_temp": 70,
      "uv_power": 0,
      "duration": 360,  
      "fan_inner": 100,
      "fan_exhaust": 12,
      "notes": "PETG-CF"
    },
    {
      "mode": "DRY",
      "name": "DRY_ABS",
      "target_temp": 80,
      "uv_power": 0,
      "duration": 420,   
      "fan_inner": 100,
      "fan_exhaust": 15,
      "notes": "ABS/ASA"
    },
    {
      "mode": "DRY",
      "name": "DRY_NYLON",
      "target_temp": 90,
      "uv_power": 0,
      "duration": 720,   
      "fan_inner": 100,
      "fan_exhaust": 15,
      "notes": "Nylon / PA"
    }

```
## CURE пресеты (engineering-grade)
```json
    {
      "mode": "CURE",
      "name": "CURE_WHITE",
      "target_temp": 32,
      "uv_power": 25,
      "duration": 10,
      "fan_inner": 100,
      "fan_exhaust": 0,
      "notes": "Белая смола: анти-пожелтение"
    },
    {
      "mode": "CURE",
      "name": "CURE_CLEAR",
      "target_temp": 28,
      "uv_power": 20,
      "duration": 8,
      "fan_inner": 100,
      "fan_exhaust": 0,
      "notes": "Прозрачная смола: анти-мутность"
    },
    {
      "mode": "CURE",
      "name": "CURE_STANDARD",
      "target_temp": 40,
      "uv_power": 45,
      "duration": 12,
      "fan_inner": 100,
      "fan_exhaust": 0,
      "notes": "Стандартные смолы"
    },
    {
      "mode": "CURE",
      "name": "CURE_ABS",
      "target_temp": 55,
      "uv_power": 70,
      "duration": 20,
      "fan_inner": 100,
      "fan_exhaust": 10,
      "notes": "ABS-like / Tough / инженерные"
    }
```


> Параметры основаны на согласованной политике проекта: DRY без UV, мягкий обдув, длительность 4–8 ч; CURE допускает T=30–50°C + UV.

---

## Правила применения
- Если `mode=DRY` → прошивка **насильно устанавливает `uv_power=0`** и игнорирует любые внешние команды UV.
- При старте пресета: публиковать статусы в топ‑бар и MQTT (если включен).
- При ошибках безопасности (дверь/перегрев/датчик) — пресет **пауза** или **стоп** в зависимости от правил Safety.

- Во всех режимах (и для всех пресетов) нагреватель и вентилятор обдува работают по единому контракту из
`07_HEATER_FAN_CONTROL.md`. Пресеты задают целевые параметры (температуру, длительность, базовый уровень обдува),
но не переопределяют правила безопасности и динамики Heater/Fan.

    ---

    ## 2. RGB Indicator, Safety & UV_LOCK Behaviour

    (source: docs/README_Files/RGB_Safety_UVLOCK.md)

    # RGB‑индикатор, Safety и UV_LOCK — поведение (v1.0)
**Updated:** 2025-11-09 11:04

Цель: единые правила поведенческой логики индикаторов и защит.

---

## RGB‑индикатор (рекомендация по цветам)

| Состояние | Цвет |
|---|---|
| Питание/инициализация | Белый мигающий |
| Wi‑Fi подключается | Синий мигающий |
| Wi‑Fi подключён, MQTT подключается | Голубой мигающий |
| Wi‑Fi+MQTT подключены (Idle/Ready) | Зелёный постоянный |
| Идёт нагрев (без UV) | Жёлтый постоянный |
| UV активен (только в CURE) | Фиолетовый постоянный |
| Пауза/ожидание (пресет на паузе) | Синий постоянный |
| Ошибка/SAFE_STATE | Красный мигающий |

Цвета можно скорректировать под читаемость, важно **устойчивое отображение** по состояниям.

---

## UV_LOCK (жёсткое правило)
- В режиме `DRY` любые команды UV **игнорируются**.
- Экран/статусы показывают UV=OFF, даже если поступила команда включить.
- Попытка включить UV в DRY → лог предупреждения (и MQTT, если есть).

---

## Safety (минимальный набор правил)
- `DoorOpen`: при открытой двери **UV немедленно OFF**; нагрев — **пауза** (по проектной политике).  
- `OverTemp`: при перегреве — OFF нагрев/UV, ERROR, требуется вмешательство.  
- `SensorFault`: при отказе критичных датчиков — останов процесса, ERROR.  
- `HeaterNoEffect`: если PWM>20% дольше N секунд, а ∆T < threshold → ошибка нагревателя.

Реакции должны **однозначно отображаться**: экран статуса/ошибки + RGB + MQTT.

---

## Топ‑бар статусов
- Значки Wi‑Fi/MQTT/Heater/UV обновляются **по delta**.  
- В режимах ERROR/SAFE_STATE топ‑бар может мигать или показывать код.

---

## Порядок запуска
1. Boot → RGB белый мигающий.  
2. Wi‑Fi → синий мигающий; при успехе → голубой (MQTT connect).  
3. MQTT ок → зелёный постоянный.  
4. При старте пресета: нагрев (жёлтый), UV (фиолетовый) — согласно режиму.  
5. Любая крит.ошибка → красный мигающий до сброса/подтверждения.

